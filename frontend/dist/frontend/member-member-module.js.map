{"version":3,"sources":["./src/app/member/member.component.ts","./src/app/member/member.component.html","./src/app/member/member-routing.module.ts","./src/app/member/member.service.ts","./src/app/member/member.module.ts"],"names":[],"mappings":"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","file":"member-member-module.js","sourcesContent":["import {\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  OnDestroy,\n  OnInit,\n} from '@angular/core';\nimport { Subject } from 'rxjs';\nimport { takeUntil } from 'rxjs/operators';\nimport { IdleSwitchState } from '../typing';\nimport { MemberService } from './member.service';\n\ninterface TableContent {\n  columns: string[];\n  rows: any[];\n}\n\n@Component({\n  selector: 'app-member',\n  templateUrl: './member.component.html',\n  styleUrls: ['./member.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class MemberComponent implements OnInit, OnDestroy {\n  idleSwitchState: IdleSwitchState = {\n    nogizakaCheck: true,\n    sakurazakaCheck: true,\n    hinatazakaCheck: true,\n  };\n\n  nogizakaTables: TableContent[];\n  sakurazakaTables: TableContent[];\n  hinatazakaTables: TableContent[];\n\n  private unsubscriber$: Subject<void> = new Subject<void>();\n\n  constructor(\n    private memberService: MemberService,\n    private cd: ChangeDetectorRef\n  ) {\n    this.memberService\n      .getMemberTable(['nogizaka', 'sakurazaka', 'hinatazaka'])\n      .pipe(takeUntil(this.unsubscriber$))\n      .subscribe((result) => {\n        result.forEach((item) => {\n          switch (item.kind) {\n            case 'nogizaka':\n              this.nogizakaTables = item.tables;\n            case 'sakurazaka':\n              this.sakurazakaTables = item.tables;\n            case 'hinatazaka':\n              this.hinatazakaTables = item.tables;\n          }\n        });\n        this.cd.markForCheck();\n      });\n  }\n\n  ngOnInit(): void {}\n\n  ngOnDestroy() {\n    this.unsubscriber$.next();\n  }\n\n  setWidth(index: number, length: number): string {\n    const baseWidth = 120;\n    if (index === length - 1) {\n      return `calc(100% - ${baseWidth * length - 1}px)`;\n    }\n    return `${baseWidth}px`;\n  }\n}\n","<div class=\"member_Wrapper\">\n  <app-idle-switcher [value]=\"idleSwitchState\"></app-idle-switcher>\n\n  <section class=\"table-section\">\n    <ng-container *ngIf=\"idleSwitchState.nogizakaCheck\">\n      <h2>乃木坂46</h2>\n      <ng-container *ngFor=\"let table of nogizakaTables\">\n        <ng-container\n          *ngTemplateOutlet=\"tableTemplate; context: table\"\n        ></ng-container>\n      </ng-container>\n    </ng-container>\n  </section>\n\n  <section class=\"table-section\">\n    <ng-container *ngIf=\"idleSwitchState.sakurazakaCheck\">\n      <h2>櫻坂46</h2>\n      <ng-container *ngFor=\"let table of sakurazakaTables\">\n        <ng-container\n          *ngTemplateOutlet=\"tableTemplate; context: table\"\n        ></ng-container>\n      </ng-container>\n    </ng-container>\n  </section>\n\n  <section class=\"table-section\">\n    <ng-container *ngIf=\"idleSwitchState.hinatazakaCheck\">\n      <h2>日向坂46</h2>\n      <ng-container *ngFor=\"let table of hinatazakaTables\">\n        <ng-container\n          *ngTemplateOutlet=\"tableTemplate; context: table\"\n        ></ng-container>\n      </ng-container>\n    </ng-container>\n  </section>\n</div>\n\n<ng-template #tableTemplate let-rows=\"rows\" let-columns=\"columns\">\n  <table>\n    <thead>\n      <tr>\n        <th\n          *ngFor=\"let col of columns; index as i\"\n          [style.width]=\"setWidth(i, columns.length)\"\n        >\n          {{ col }}\n        </th>\n      </tr>\n    </thead>\n    <tbody>\n      <tr *ngFor=\"let row of rows\">\n        <td\n          *ngFor=\"let col of columns; index as i\"\n          [style.width]=\"setWidth(i, columns.length)\"\n        >\n          <ng-container [ngSwitch]=\"col\">\n            <ng-container *ngSwitchCase=\"'link'\">\n              <a\n                class=\"table-column__link-anchor\"\n                *ngFor=\"let link of row[col]\"\n                [href]=\"link.link\"\n                target=\"_blank\"\n                >{{ link.host }}</a\n              >\n            </ng-container>\n\n            <ng-container *ngSwitchDefault>\n              {{ row[col] }}\n            </ng-container>\n          </ng-container>\n        </td>\n      </tr>\n    </tbody>\n  </table>\n</ng-template>\n","import { NgModule } from '@angular/core';\nimport { RouterModule, Routes } from '@angular/router';\nimport { MemberComponent } from './member.component';\n\nconst routes: Routes = [{ path: '', component: MemberComponent }];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule],\n})\nexport class MemberRoutingModule {}\n","import { formatDate } from '@angular/common';\nimport { HttpClient } from '@angular/common/http';\nimport { Injectable } from '@angular/core';\nimport { forkJoin, Observable, of } from 'rxjs';\nimport { catchError, map } from 'rxjs/operators';\nimport { IdleKind, MemberLinks } from '../typing';\n\ninterface TableContent {\n  columns: string[];\n  rows: any[];\n}\n\ninterface BulkIdleResult {\n  kind: IdleKind;\n  value: object[][];\n  tables?: TableContent[];\n}\n\ninterface BulkIdleLink {\n  kind: IdleKind;\n  value: MemberLinks[];\n}\n\n@Injectable({ providedIn: 'root' })\nexport class MemberService {\n  constructor(private http: HttpClient) {}\n\n  getLinks(idles: IdleKind[]): Observable<BulkIdleLink[]> {\n    const query = idles.map((site) => `kind[]=${site}`).join('&');\n    return this.http.get<BulkIdleLink[]>(`api/v1/member-links?${query}`);\n  }\n\n  getMemberTable(idles: IdleKind[]): Observable<BulkIdleResult[]> {\n    const query = idles.map((site) => `kind[]=${site}`).join('&');\n    return forkJoin([\n      this.getLinks(idles),\n      this.http.get<BulkIdleResult[]>(`api/v1/member-table?${query}`),\n    ]).pipe(\n      map(([linkResult, tableResult]) => {\n        const links: {\n          [kind: string]: { [name: string]: string[] };\n        } = linkResult.reduce((linkAcc, result) => {\n          linkAcc[result.kind] = result.value.reduce((memberAcc, member) => {\n            memberAcc[member.name] = member.links;\n            return memberAcc;\n          }, {});\n          return linkAcc;\n        }, {});\n\n        return tableResult.map((item) => {\n          const idleLinks = links[item.kind];\n          item.tables = item.value.map((table) =>\n            this.parseTable(table, idleLinks)\n          );\n          return item;\n        });\n      }),\n      catchError((err) => {\n        console.error(err);\n        return of(undefined);\n      })\n    );\n  }\n\n  private parseTable(\n    table: object[],\n    links: { [name: string]: string[] }\n  ): TableContent {\n    const columnArray = table.map((row) => Object.keys(row));\n    let columnMaxLength = 0;\n    let columns: string[];\n    for (const currentColumn of columnArray) {\n      if (currentColumn.length > columnMaxLength) {\n        columns = currentColumn;\n        columnMaxLength = currentColumn.length;\n      }\n    }\n    columns = columns.filter((col) => !['備考', 'よみ'].includes(col));\n\n    table = table.map((row) => {\n      columns = columns.map((column) => {\n        try {\n          const date = new Date(row[column]);\n          if (date instanceof Date) {\n            row[column] = formatDate(date, 'y/M/d', 'en-US');\n          }\n        } catch (e) {}\n        if (column === '出身地') {\n          if (/^\\d{1,2}.+$/.test(row[column])) {\n            row[column] = row[column].replace(/^\\d{1,2}(.+)$/, (match, p) => p);\n          }\n        }\n        if (column === 'link') {\n          row[column] = (links[row['名前']] || []).map((link) => {\n            const url = new URL(link);\n            return { host: url.host, link };\n          });\n        }\n        return column;\n      });\n      return row;\n    });\n\n    return { columns, rows: table };\n  }\n}\n","import { CommonModule } from '@angular/common';\nimport { NgModule } from '@angular/core';\nimport { SharedModule } from '../shared/shared.module';\nimport { MemberRoutingModule } from './member-routing.module';\nimport { MemberComponent } from './member.component';\n\n@NgModule({\n  declarations: [MemberComponent],\n  imports: [CommonModule, SharedModule, MemberRoutingModule],\n})\nexport class MemberModule {}\n"],"sourceRoot":"webpack:///"}